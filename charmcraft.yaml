type: charm
name: ddeb-retriever
title: ddeb-retriever
summary: Maintain a mirror of ddeb
description: |
  ddeb-retriever fetches ddeb to serve a debug symbol archive.

base: ubuntu@24.04
platforms:
  amd64: null
  arm64: null

parts:
  charm:
    plugin: uv
    source: .
    build-snaps:
      - astral-uv

charm-libs:
  - lib: traefik_k8s.ingress
    version: "2"

config:
  options:
    git-repository:
      description: |
        Source git repository of ddeb-retriever
      default: "https://git.launchpad.net/ddeb-retriever"
      type: string
    git-ref:
      description: |
        Source git ref of ddeb-retriever.
        Can be a branch name, tag, or full commit hash.
      default: "main"
      type: string
    schedule:
      description: |
        Running schedule in systemd calendar format.
        Can be tested using: systemd-analyze calendar <schedule>
      default: "daily"
      type: string
    gpg-key:
      description: |
        Private key to sign the generated indexes.
      type: string

actions:
  update:
    description: Update the git checkout.
  pause:
    description: Pause the service.
  resume:
    description: Resume the service.
  run:
    description: |
      Run the importer now.
      Args can be passed to the underlying command. e.g.
        juju run ddeb-retriever/leader run args="-h" 
    properties:
      args:
        description: Arguments to pass to ddeb-retriever
        type: string

requires:
  ingress:
    interface: ingress
    limit: 1
